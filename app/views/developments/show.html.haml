- content_for(:page_title) { page_title("Development " + @development.application_number) }

.govuk-width-container
  = link_to "Back to all developments", developments_path, class: "govuk-back-link"
  .govuk-grid-row
    .govuk-grid-column-full-from-desktop
      %h1.govuk-heading-xl Development #{@development.application_number}
      %dl.govuk-summary-list{:class => "govuk-!-margin-bottom-9"}

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Status
          %dd.govuk-summary-list__value
            %p.govuk-tag= @development.state.titleize
          %dd.govuk-summary-list__actions
            - case @development.state
            - when 'draft'
              = link_to agree_confirmation_development_path(@development), class: "govuk-link" do
                Mark as agreed
            - when 'agreed'
              = link_to start_confirmation_development_path(@development), class: "govuk-link" do
                Mark as started
            - when 'started'
              = link_to complete_confirmation_development_path(@development), class: "govuk-link" do
                Mark as completed

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Proposal
          %dd.govuk-summary-list__value
            %p.govuk-body= @development.proposal
          %dd.govuk-summary-list__actions
            = link_to edit_development_path(@development), class: "govuk-link" do
              Edit
              %span.govuk-visually-hidden proposal

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Address
          %dd.govuk-summary-list__value
            %p.govuk-body= @development.site_address
          %dd.govuk-summary-list__actions
            = link_to edit_development_path(@development), class: "govuk-link" do
              Edit
              %span.govuk-visually-hidden address

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Dwellings
          %dd.govuk-summary-list__value
            %p.govuk-body=t('dwellings_count', count: @development.dwellings.count)
          %dd.govuk-summary-list__actions
            = link_to development_dwellings_path(@development) do
              Manage
              %span.govuk-visually-hidden dwellings
%table
  - @development.own_and_associated_audits.order(created_at: :asc).each do |audit|
    %tr.changelog_row
      %td= audit.created_at.to_s(:short)
      %td= audit.user&.email
      %td= audit.auditable_type
      %td= audit.action
      %td= audit.audited_changes.collect {|key,change| "#{key.humanize(capitalize: false)} changed from \"#{change[0]}\" to \"#{change[1]}\""}.to_sentence
      %td= audit.comment
