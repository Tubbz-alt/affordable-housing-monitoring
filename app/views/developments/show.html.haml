- content_for(:page_title) { page_title("Development " + @development.primary_application_number) }


.govuk-width-container
  = link_to "Back to all developments", developments_path, class: "govuk-back-link"

  .govuk-grid-row
    .govuk-grid-column-full-from-desktop
      %h1.govuk-heading-xl Development #{@development.primary_application_number}

  .govuk-tabs{"data-module" => "govuk-tabs"}
    %h2.govuk-tabs__title
      Contents
    %ul.govuk-tabs__list
      %li.govuk-tabs__list-item.govuk-tabs__list-item--selected
        %a.govuk-tabs__tab{:href => "#development-details"}
          Development details
      - if @development.dwellings.any?
        %li.govuk-tabs__list-item
          %a.govuk-tabs__tab{:href => "#statistics"}
            Statistics
        %li.govuk-tabs__list-item
          %a.govuk-tabs__tab{:href => "#dwellings"}
            Dwellings
      %li.govuk-tabs__list-item
        %a.govuk-tabs__tab{:href => "#changes-to-legal-agreement"}
          Changes to legal agreement

    %section#development-details.govuk-tabs__panel
      %h2.govuk-heading-l Development details

      - if @development.completion_response_needed?
        = render 'developer_response_required'
      - if @development.completion_response_filled?
        = render 'developer_response_given'

      %dl.govuk-summary-list{:class => "govuk-!-margin-bottom-9"}
        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Name
          %dd.govuk-summary-list__value
            %p.govuk-body= @development.name || 'Not yet added'
          %dd.govuk-summary-list__actions
            = link_to edit_development_path(@development), class: "govuk-link" do
              Edit
              %span.govuk-visually-hidden name

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Status
          %dd.govuk-summary-list__value
            %span.govuk-tag{class: "govuk-tag-#{@development.state}"}= @development.state.titleize
          %dd.govuk-summary-list__actions
            - case @development.state
            - when 'draft'
              = link_to agree_confirmation_development_path(@development), class: "govuk-link" do
                Mark as agreed
            - when 'agreed'
              = link_to start_confirmation_development_path(@development), class: "govuk-link" do
                Mark as started
            - when 'started'
              = link_to complete_confirmation_development_path(@development), class: "govuk-link" do
                Mark as completed

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Site address
          %dd.govuk-summary-list__value
            %p.govuk-body= @development.site_address
          %dd.govuk-summary-list__actions
            = link_to edit_development_path(@development), class: "govuk-link" do
              Edit
              %span.govuk-visually-hidden address

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Planning Applications
          %dd.govuk-summary-list__value
            %p.govuk-body= @development.planning_applications.collect(&:application_number).join(', ')
          %dd.govuk-summary-list__actions
            = link_to development_planning_applications_path(@development), class: "govuk-link" do
              Manage
              %span.govuk-visually-hidden planning applications

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Proposal
          %dd.govuk-summary-list__value
            %p.govuk-body= @development.proposal
          %dd.govuk-summary-list__actions
            = link_to edit_development_path(@development), class: "govuk-link" do
              Edit
              %span.govuk-visually-hidden proposal

        .govuk-summary-list__row
          %dt.govuk-summary-list__key
            Dwellings
          %dd.govuk-summary-list__value
            %p.govuk-body=t('dwellings_count', count: @development.dwellings.count)
          %dd.govuk-summary-list__actions
            = link_to development_dwellings_path(@development), class: "govuk-link" do
              Manage
              %span.govuk-visually-hidden dwellings

    %section#statistics.govuk-tabs__panel.govuk-tabs__panel--hidden
      %h2.govuk-heading-l Statistics
      - if @development.dwellings.any?
        = render 'partials/statistics'

    %section#changes-to-legal-agreement.govuk-tabs__panel.govuk-tabs__panel--hidden
      %h2.govuk-heading-l Changes to legal agreement

    %section#dwellings.govuk-tabs__panel.govuk-tabs__panel--hidden
      %h2.govuk-heading-l Dwellings

      = link_to 'Add a new dwelling', new_development_dwelling_path(@development), class: 'govuk-button' unless @development.completed?

      = render 'developments/developer_response_given' if @development.completion_response_filled?

      .table-scrollable
        %table.govuk-table
          %caption.govuk-table__caption.govuk-visually-hidden Dwellings
          %thead.govuk-table__head
            %tr.govuk-table__row
              %th{class: "govuk-table__header", scope: "col"} Reference ID
              %th{class: "govuk-table__header", scope: "col"} Address
              %th{class: "govuk-table__header", scope: "col"} Registered provider
              %th{class: "govuk-table__header", scope: "col"} Tenure
              %th{class: "govuk-table__header govuk-table__header--numeric", scope: "col"} Habitable rooms
              %th{class: "govuk-table__header govuk-table__header--numeric", scope: "col"} Bedrooms
              %th{class: "govuk-table__header", scope: "col"} Last updated
              %th{class: "govuk-table__header", scope: "col"} Actions

          %tbody.govuk-table__body
            -@development.dwellings.each do |dwelling|
              %tr.govuk-table__row
                %th.govuk-table__header{scope: "row"}= dwelling.reference_id
                %td.govuk-table__cell= dwelling.address.present? ? dwelling.address : 'Not yet supplied'
                %td.govuk-table__cell= dwelling.registered_provider.present? ? dwelling.registered_provider.name : 'Not yet supplied'
                %td.govuk-table__cell= dwelling.tenure
                %td.govuk-table__cell.govuk-table__cell--numeric=dwelling.habitable_rooms
                %td.govuk-table__cell.govuk-table__cell--numeric=dwelling.bedrooms
                %td.govuk-table__cell= distance_of_time_in_words(dwelling.updated_at, Time.now) + " ago"
                %td.govuk-table__cell= link_to 'Edit', edit_development_dwelling_path(@development, dwelling), class: "govuk-link", "aria-label": "Edit dwelling #{dwelling.reference_id}"

      = render 'partials/changelog'
